<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地图标记点信息展示系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg,#1a3762,#1a3762);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 20px auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, #ff8a00, #e52e71, #22c1c3);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .map-container {
            position: relative;
            width: 1200px;
            height: 850px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            margin: 0 auto;
        }
        
        .world-map {
            background: url('https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAKBJWiddU9xtD-i7z_2rkTCRujnlcGbAALxGwACSijwVIG8uTlD_ZAVNgQ.jpg');
            width: 1200px;
            height: 850px;
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-position: 0 0;
        }
        
        .location {
            position: absolute;
            width: 32px;
            height: 32px;
            background: #ff4757;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 0 8px rgba(255, 71, 87, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .location:hover {
            transform: scale(1.2);
            box-shadow: 0 0 0 12px rgba(255, 71, 87, 0.5);
        }
        
        .location i {
            color: white;
            font-size: 16px;
        }
        
        .location::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(255, 71, 87, 0.6);
            animation: pulse 2s infinite;
            z-index: -1;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .info-box {
            position: absolute;
            top: 50%;
            right: 30px;
            transform: translateY(-50%);
            width: 900px;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            display: none;
            z-index: 100;
            transition: all 0.4s ease;
        }
        
        .info-box.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-50%) translateX(20px); }
            to { opacity: 1; transform: translateY(-50%) translateX(0); }
        }
        
        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .info-title {
            font-size: 1.8rem;
            color: #fc2f2f;
        }
        
        .close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255, 71, 87, 0.7);
            transform: rotate(90deg);
        }
        
        .info-content {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
            padding-bottom: 20px;
        }
        
        .info-content::-webkit-scrollbar {
            width: 6px;
        }
        .info-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
        }
        
        .info-image {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 20px;
            max-height: 750px;
            object-fit: cover;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .info-content p {
            line-height: 1.7;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        .info-content ul {
            padding-left: 20px;
            margin-bottom: 20px;
        }
        
        .info-content li {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .location-list {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .location-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 25px;
            width: 260px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .location-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }
        
        .location-card.active {
            background: rgba(255, 71, 87, 0.3);
            border: 1px solid #ff4757;
        }
        
        .location-card h4 {
            color: #f10606;
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        footer {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            font-size: 1rem;
            opacity: 0.8;
            width: 100%;
        }
        
        /* 视频容器样式 */
        .video-container {
            margin: 15px 0;
            width: 100%;
            max-width: 850px;
            margin-left: auto;
            margin-right: auto;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }
        
        .video-container video {
            width: 100% !important;
            max-width: 800px !important;
            height: auto !important;
            min-height: 300px;
            border-radius: 4px;
            object-fit: contain;
        }
        
        .video-status {
            color: #4dd0e1;
            font-size: 0.9rem;
            margin: 8px 0;
            display: block;
        }
        
        .video-error {
            color: #ff4757;
            font-size: 0.9rem;
            margin: 8px 0;
            padding: 8px;
            background: rgba(255, 71, 87, 0.1);
            border-radius: 4px;
        }
        
        .video-path {
            font-size: 0.8rem;
            color: #bbb;
            word-break: break-all;
            margin-top: 10px;
        }
        
        .video-container p {
            margin-bottom: 8px !important;
            font-size: 0.95rem;
            color: #f0f0f0;
        }
        
        /* 视频加载进度条 */
        .video-progress-container {
            width: 100%;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 8px 0;
            overflow: hidden;
        }
        
        .video-progress {
            height: 100%;
            background-color: #4dd0e1;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* 网络质量指示器 */
        .network-quality {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .quality-poor {
            background-color: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }
        
        .quality-medium {
            background-color: rgba(255, 183, 77, 0.2);
            color: #ffb74d;
        }
        
        .quality-good {
            background-color: rgba(77, 208, 225, 0.2);
            color: #4dd0e1;
        }
        
        /* 清晰度选择器样式 */
        .video-quality-selector {
            margin-bottom: 8px;
        }
        
        .video-quality-selector select {
            background: rgba(0,0,0,0.5);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 3px 5px;
            border-radius: 4px;
        }
        
        /* 视频源信息样式 */
        .video-source-info {
            font-size: 0.8rem;
            color: #bbb;
            margin-top: 8px;
        }
        
        .video-source-info button {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: #bbb;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 10px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .video-source-info button:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        @media (max-width: 900px) {
            .info-box {
                width: 300px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .video-container {
                max-width: 280px;
            }
            
            .video-container video {
                min-height: 200px;
            }
        }
        
        @media (max-width: 768px) {
            .map-container {
                height: 300px;
            }
            
            .info-box {
                width: 280px;
                right: 15px;
            }
            
            .location-card {
                width: 140px;
                padding: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .map-container {
                height: 500px;
            }
            
            .info-box {
                width: 90%;
                left: 5%;
                right: auto;
                top: 50px;
                transform: none;
            }
            
            .location {
                width: 28px;
                height: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-map-marked-alt"></i> 黄埔海事处风险点</h1>
            <p class="subtitle">点击地图上的标记点，查看风险点详细信息</p>
        </header>
        
        <div class="map-container">
            <!-- 地图背景 -->
            <div class="world-map"></div>
            
            <!-- 位置标记点 -->
            <div class="location" style="top: 500px; left: 865px;" data-id="1">
                <i class="fas fa-map-pin"></i>
            </div>
            
            <div class="location" style="top: 400px; left: 792px;" data-id="2">
                <i class="fas fa-map-pin"></i>
            </div>
            
            <div class="location" style="top: 365px; left: 588px;" data-id="3">
                <i class="fas fa-map-pin"></i>
            </div>
            
            <div class="location" style="top: 357px; left:444px;" data-id="4">
                <i class="fas fa-map-pin"></i>
            </div>
            
            <div class="location" style="top: 382px; left:720px;" data-id="5">
                <i class="fas fa-map-pin"></i>
            </div>
            
            <div class="location" style="top: 578px; left: 972px;" data-id="6">
                <i class="fas fa-map-pin"></i>
            </div>
            
            <div class="location" style="top: 433px; left: 516px;" data-id="7">
                <i class="fas fa-map-pin"></i>
            </div>

            <div class="location" style="top: 476px; left: 1020px;" data-id="8">
                <i class="fas fa-map-pin"></i>
            </div>

            <!-- 信息框 -->
            <div class="info-box" id="infoBox">
                <div class="info-header">
                    <h2 class="info-title" id="infoTitle">位置信息</h2>
                    <button class="close-btn" id="closeInfo"><i class="fas fa-times"></i></button>
                </div>
                
                <div class="info-content" id="infoContent">
                    <!-- 动态内容将在这里显示 -->
                </div>
            </div>
        </div>
        
        <div class="location-list">
            <div class="location-card" data-id="1">
                <h4><i class="fas fa-tree"></i> 风险点1</h4>
            </div>
            <div class="location-card" data-id="2">
                <h4><i class="fas fa-tree"></i> 风险点2</h4>
            </div>
            <div class="location-card" data-id="3">
                <h4><i class="fas fa-tree"></i> 风险点3</h4>
            </div>
            <div class="location-card" data-id="4">
                <h4><i class="fas fa-tree"></i> 风险点4</h4>
            </div>
            <div class="location-card" data-id="5">
                <h4><i class="fas fa-tree"></i> 风险点5</h4>
            </div>
            <div class="location-card" data-id="6">
                <h4><i class="fas fa-tree"></i> 风险点6</h4>
            </div>
            <div class="location-card" data-id="7">
                <h4><i class="fas fa-tree"></i> 风险点7</h4>
            </div>
            <div class="location-card" data-id="8">
                <h4><i class="fas fa-tree"></i> 风险点8</h4>
            </div>
        </div>
        
        <footer>
            <p>风险信息展示系统 | © 2025 版权所有</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 生成带时间戳的视频URL，避免缓存
            function getVideoUrl(baseUrl) {
                return baseUrl + "?timestamp=" + new Date().getTime();
            }
            
            // 位置数据 - 已适配阿里云视频存储
            // 请将下方URL替换为你在阿里云OSS中的实际视频地址
            const locationData = {
                1: {
                    title: "风险点1",
                    icon: "tree",
                    image: "https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAKBTGidfF1-wGcMNiCHwElOGvbKA_kYAAI2HAACSijwVAWgswxZmK2oNgQ.jpg",
                    image2:"",
                    description: "大濠洲水道西南侧、东1号灯浮西北角水域，位于大濠洲水道与铁桩水道交汇处(见上图，易搁浅水域)",
                    details: ["1、船舶进出广州港东河道1号至6号灯浮航段时，应当谨慎驾驶加强了望，注意避让，加强与周围船舶的联系。<br>",
                              "2、深吃水船舶应保持在主航道航行，偏离航道进入上述浅点水域极易发生搁浅事故。<br>",
                              "3、禁止船舶在大濠洲航道追越\会船。<br>"
                    ]
                },
                2: {
                    title: "风险点2",
                    icon: "tree",
                    image: "https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAKBS2idfFxS0Mcy_VoM4c5dN3OiuPEPAAI1HAACSijwVCQiBHdltSvRNgQ.jpg",
                    videos: {
                        sources: [
                            {
                                name: "阿里云主源",
                                url: "https://marutime-videos.oss-cn-shenzhen.aliyuncs.com/%E8%8F%A0%E8%90%9D%E5%BA%99%E6%B0%B4%E9%81%931.mp4"
                                // 替换为你的阿里云视频URL
                            },
                            {
                                name: "阿里云备用源",
                                url: "https://marutime-videos.oss-cn-shenzhen.aliyuncs.com/%E9%A3%8E%E9%99%A9%E7%82%B9%E5%9B%9B.mp4"
                                // 替换为你的阿里云备用视频URL
                            }
                        ],
                        qualities: [
                            {
                                name: "高清(1080p)",
                                suffix: "_1080p"
                            },
                            {
                                name: "标清(720p)",
                                suffix: "_720p"
                            },
                            {
                                name: "流畅(480p)",
                                suffix: "_480p"
                            }
                        ]
                    },
                    description: "广州港东河道5号、6灯浮与大二石灯浮(孤立危险物标)之间水域为“大二石”礁盘(见上图，大二石礁盘)，海图水深-3.5 米至-5.8米，底质为石质",
                    details: [
                        "1、船舶进出广州港东河道1号至6号灯浮航段时，应当谨慎驾驶加强了望，注意避让，加强与周围船舶的联系。<br>",
                              "2、深吃水船舶应保持在主航道航行，偏离航道进入上述浅点水域极易发生搁浅事故。<br>",
                              "3、禁止船舶在大濠洲航道追越\会船。<br>"
                    ]
                },
                3: {
                    title: "风险点3",
                    icon: "tree",
                    image: "https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAJ8emib-NsKrw8ORy2rqW_X6_JwwqI9AAKXFwACSijgVMc3rKP9yfcNNgQ.jpg",
                    description: "黄埔老港 P4和P5 之间的老港调头区(见图二，老港掉头区)北侧为拖轮码头，南侧为东7号灯浮，难以满足大型船舶掉头需要为确保船舶航行安全，防止发生碰撞、搁浅等事故险情，建议需在黄埔老港港区掉头的大型船舶选择到洪圣沙码头对开的P5锚地附近水域掉头(见图二，P5锚地)",
                    details: [
                        "1、掉头船舶应根据需要申请拖轮协助，并视情况选择下锚掉头。<br>",
                        "2、船舶掉头时，应密切关注周围环境，不得妨碍他船的正常航行。<br>"
                    ]
                },
                4: {
                    title: "风险点4",
                    icon: "tree",
                    image: "https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAKXmWikIdJ_cSopiYov-NuEsMTHqqIAA10aAAIOQChVzLd7fI9QnUg2BA.jpg",
                    image2:"https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAKXlmikIdFbH_0EqJeJUlPriwPuPxt5AAJaGgACDkAoVRT7oaXWpzpINgQ.jpg",
                    image3:"https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAKXmGikIdGOIe4PB09zJ3xaRUefLPSTAAJcGgACDkAoVbWlj-jGnnSCNgQ.jpg",
                    videos: {
                        sources: [
                            {
                                name: "阿里云主源",
                                url: "https://marutime-videos.oss-cn-shenzhen.aliyuncs.com/%E9%A3%8E%E9%99%A9%E7%82%B9%E5%9B%9B.mp4"
                                // 替换为你的阿里云视频URL
                            },
                            {
                                name: "阿里云备用源",
                                url: "https://marutime-videos.oss-cn-shenzhen.aliyuncs.com/%E6%96%87%E5%86%B2%E8%88%B9%E5%8E%82%E9%99%84%E8%BF%91.mp4"
                                // 替换为你的阿里云备用视频URL
                            }
                        ],
                        qualities: [
                            {
                                name: "高清(1080p)",
                                suffix: "_1080p"
                            },
                            {
                                name: "标清(720p)",
                                suffix: "_720p"
                            },
                            {
                                name: "流畅(480p)",
                                suffix: "_480p"
                            }
                        ]
                    },
                    description: "鱼珠码头位于黄埔区东南端黄埔水道北侧，鱼珠－长洲车渡跨越黄埔水道连鱼珠码头至长洲码头，是黄埔通往长洲岛的重要水上通道，渡船有“穗车渡01”等。",
                    details: [
                        "1、当能见度不满1000米时，渡船禁止航行；正常目视能见度可清晰看到对岸渡口码头或岸线时，渡船不受上述能见度距离限制，在确保安全前提下可以开航。<br>",
                        "2、渡线上下游150米范围内禁止锚泊。<br>",
                        "3、顺航道行驶船舶应注意加强瞭望，谨慎驾驶，防范发生碰撞等事故险情。<br>"
                    ]
                },
                5: {
                    title: "风险点5",
                    icon: "tree",
                    image: "https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAKXl2ikIdG4-TfMGTIs1D-5zBihu-L8AAJbGgACDkAoVfryxSbnDKR0NgQ.jpg",
                    description: "乌涌联围渡口位于黄埔港前路的乌涌水闸旁，乌涌联围－大吉沙渡线跨越黄埔水道连接大吉沙岛，渡口共有客渡船两艘“粤广州渡0080”、“粤广州渡0099”。",
                    details: [
                        "1、当能见度不满1000米时，渡船禁止航行；正常目视能见度可清晰看到对岸渡口码头或岸线时，渡船不受上述能见度距离限制，在确保安全前提下可以开航。<br>",
                        "2、渡线上下游150米范围内禁止锚泊。<br>",
                        "3、顺航道行驶船舶应注意加强瞭望，谨慎驾驶，避让往来渡船和乡镇船舶，防范发生碰撞等事故险情。<br>"
                    ]
                },
                6: {
                    title: "风险点6",
                    icon: "tree",
                    image: "https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAKAzWidUagLMsGBb8DrfWuyMHpw3tj9AAIdGwACSijwVO4AAYhzmwAB72Y2BA.jpg",
                    description: "黄埔大桥",
                    details: [
                        "黄埔大桥(南汉)桥梁净空高60米，起重船等超高船舶应放下吊臂通过。"
                    ]
                },
                7: {
                    title: "风险点7",
                    icon: "tree",
                    image: "https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAKAzGidUahpKFICuDnsyGlKVFKZJQkcAAIcGwACSijwVCwppitWI71ZNgQ.jpg",
                    description: "沙鹭江水道东连铁桩水道，西接黄埔洪圣沙西角与长洲车渡连线，总长1.5公里，水道宽度约120-200米，为天然通航水道，没有设定维护水深，底质为泥沙。沙鹭江水道日常船舶流量较少，主要为船长70米以下的货船。",
                    details: [
                        "1、航道内有管线，禁止船舶在管线保护水域内抛锚。<br>",
                        "2、航道西侧有盛东船厂，在船厂水域靠泊多档船舶可能占用通航水域，影响通航安全。<br>",
                        "3、沙鹭江与铁桩水道交汇处受潮水转流影响可能水流较急，易发生搁浅事故险情，船舶应谨慎驾驶。<br>"
                    ]
                },
                8: {
                    title: "风险点8",
                    icon: "tree",
                    image: "https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAKAyWidUUhutRrTrjQ6qgRIX-Glm30-AAIZGwACSijwVF3HXEPCfb1cNgQ.jpg",
                    description: "菠萝庙水道东起省油码头北端，西至文冲船厂的造船码头，为天然通航水道，总长3.5公里，水道宽度约150-400米，习惯航路水深5.2-8米，没有设定维护水深，底质为泥沙。黄埔大桥北汊斜拉桥一孔跨过菠萝庙水道，主跨383米，满足I级航道（海轮航道）280x55米（单孔单向）的通航净空尺度要求。",
                    details: [
                        "1、菠萝庙水道狭窄，船舶交通流量较大，通航环境复杂。<br>",
                        "2、菠萝庙水道北岸码头密集，特别是大型船厂多，俗称“修船一条街”。<br>",
                        "3、黄埔大桥北汊一孔跨过菠萝庙水道，主跨383米，通航净宽280米、净高55米。<br>"
                    ]
                }
            };

            // 网络质量检测
            let networkQuality = 'unknown';
            function checkNetworkQuality() {
                if (navigator.connection) {
                    const downlink = navigator.connection.downlink; // Mbps
                    if (downlink < 1) {
                        networkQuality = 'poor';
                    } else if (downlink < 5) {
                        networkQuality = 'medium';
                    } else {
                        networkQuality = 'good';
                    }
                }
                return networkQuality;
            }

            // 多源视频加载函数
            function loadVideoWithFallbacks(videoElement, sources, currentSourceIndex = 0) {
                if (currentSourceIndex >= sources.length) {
                    return Promise.reject("所有视频源均加载失败");
                }
                
                const statusElement = document.getElementById('videoStatus');
                const progressBar = document.getElementById('videoProgress');
                
                if (statusElement) {
                    statusElement.textContent = `正在从${sources[currentSourceIndex].name}加载视频...`;
                }
                
                return new Promise((resolve, reject) => {
                    // 清除之前的事件监听器
                    const oldOnError = videoElement.onerror;
                    const oldOnCanPlay = videoElement.oncanplay;
                    
                    // 生成带时间戳的URL
                    const timestampUrl = getVideoUrl(sources[currentSourceIndex].url);
                    
                    videoElement.src = timestampUrl;
                    videoElement.load();
                    
                    // 监控进度
                    const progressHandler = () => {
                        if (videoElement.buffered.length > 0) {
                            const bufferedEnd = videoElement.buffered.end(videoElement.buffered.length - 1);
                            const duration = videoElement.duration;
                            if (duration > 0 && progressBar) {
                                const loadedPercent = (bufferedEnd / duration) * 100;
                                progressBar.style.width = loadedPercent + '%';
                            }
                        }
                    };
                    
                    videoElement.addEventListener('progress', progressHandler);
                    
                    // 加载成功
                    videoElement.oncanplay = () => {
                        videoElement.removeEventListener('progress', progressHandler);
                        videoElement.oncanplay = oldOnCanPlay;
                        resolve(currentSourceIndex);
                    };
                    
                    // 加载失败，尝试下一个源
                    videoElement.onerror = (e) => {
                        videoElement.removeEventListener('progress', progressHandler);
                        videoElement.onerror = oldOnError;
                        
                        console.error(`视频源${currentSourceIndex}加载失败，尝试下一个...`, e);
                        if (statusElement) {
                            statusElement.textContent = `${sources[currentSourceIndex].name}加载失败，尝试${sources[currentSourceIndex + 1]?.name || '备用方案'}...`;
                        }
                        
                        // 递归尝试下一个源
                        loadVideoWithFallbacks(videoElement, sources, currentSourceIndex + 1)
                            .then(resolve)
                            .catch(reject);
                    };
                    
                    // 超时处理
                    setTimeout(() => {
                        if (videoElement.readyState < 2) {
                            console.log(`视频源${currentSourceIndex}加载超时`);
                            videoElement.onerror({ type: 'timeout' });
                        }
                    }, 15000);
                });
            }

            // 添加重试按钮
            function addRetryButton(video, baseUrl) {
                if (!document.getElementById('retryVideoBtn')) {
                    const retryBtn = document.createElement('button');
                    retryBtn.id = 'retryVideoBtn';
                    retryBtn.style.background = 'rgba(255,255,255,0.1)';
                    retryBtn.style.border = 'none';
                    retryBtn.style.color = 'white';
                    retryBtn.style.padding = '5px 10px';
                    retryBtn.style.borderRadius = '4px';
                    retryBtn.style.marginTop = '8px';
                    retryBtn.style.cursor = 'pointer';
                    retryBtn.innerHTML = '<i class="fas fa-redo"></i> 重试加载';
                    
                    retryBtn.addEventListener('click', () => {
                        // 重置进度条
                        const progressBar = document.getElementById('videoProgress');
                        if (progressBar) progressBar.style.width = '0%';
                        
                        // 生成新的时间戳URL重试
                        video.src = getVideoUrl(baseUrl);
                        const statusElement = document.getElementById('videoStatus');
                        if (statusElement) {
                            statusElement.textContent = '重新加载中...';
                            statusElement.className = 'video-status';
                        }
                        video.load();
                        
                        // 移除重试按钮
                        retryBtn.remove();
                    });
                    
                    const statusElement = document.getElementById('videoStatus');
                    if (statusElement) {
                        statusElement.parentNode.appendChild(retryBtn);
                    }
                }
            }

            // 视频错误代码解释
            function getVideoErrorText(code) {
                const errors = {
                    1: '用户终止了加载',
                    2: '网络错误（可能被拦截或连接失败）',
                    3: '解码错误（视频编码不是H.264+AAC或文件损坏）',
                    4: '视频格式不支持（必须是MP4格式）'
                };
                return errors[code] || `未知错误（代码：${code}）`;
            }

            // 获取DOM元素
            const locations = document.querySelectorAll('.location');
            const locationCards = document.querySelectorAll('.location-card');
            const infoBox = document.getElementById('infoBox');
            const infoTitle = document.getElementById('infoTitle');
            const infoContent = document.getElementById('infoContent');
            const closeBtn = document.getElementById('closeInfo');
            
            // 为每个位置点添加点击事件
            locations.forEach(location => {
                location.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const locationId = this.getAttribute('data-id');
                    showLocationInfo(locationId);
                    highlightLocation(locationId);
                });
            });
            
            // 为位置卡片添加点击事件
            locationCards.forEach(card => {
                card.addEventListener('click', function() {
                    const locationId = this.getAttribute('data-id');
                    showLocationInfo(locationId);
                    highlightLocation(locationId);
                    
                    // 高亮显示当前卡片
                    locationCards.forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // 显示位置信息
            function showLocationInfo(locationId) {
                const data = locationData[locationId];
                
                // 检测网络质量
                checkNetworkQuality();
                
                // 更新信息框内容
                infoTitle.innerHTML = `<i class="fas fa-${data.icon}"></i> ${data.title}`;
                infoContent.innerHTML = `
                    <div class="image-container">
                        <img src="${data.image}" alt="${data.title}" class="info-image">
                        ${data.image2 ? `<img src="${data.image2}" alt="${data.title}" class="info-image">` : ''}
                        ${data.image3 ? `<img src="${data.image3}" alt="${data.title}" class="info-image">` : ''}
                    </div>
                    
                    ${data.videos ? `
                    <div class="video-container">
                        <p>相关视频：
                            <span class="network-quality quality-${networkQuality}">
                                ${networkQuality === 'poor' ? '网络质量差' : 
                                  networkQuality === 'medium' ? '网络质量中等' : '网络质量良好'}
                            </span>
                        </p>
                        
                        ${data.videos.qualities && data.videos.qualities.length > 1 ? `
                        <div class="video-quality-selector">
                            <label>清晰度：</label>
                            <select id="qualitySelector">
                                ${data.videos.qualities.map((q, i) => `
                                    <option value="${i}">${q.name}</option>
                                `).join('')}
                            </select>
                        </div>
                        ` : ''}
                        
                        <span class="video-status" id="videoStatus">准备加载视频...</span>
                        <div class="video-progress-container">
                            <div class="video-progress" id="videoProgress"></div>
                        </div>
                        <video controls crossorigin="anonymous" preload="metadata" id="locationVideo">
                            您的浏览器不支持HTML5视频播放
                        </video>
                        
                        ${data.videos.sources && data.videos.sources.length > 1 ? `
                        <div class="video-source-info">
                            当前来源：<span id="currentSourceName">${data.videos.sources[0].name}</span>
                            <button id="switchSourceBtn">切换来源</button>
                        </div>
                        ` : ''}
                    </div>
                    ` : ''}
                    
                    <p>${data.description}</p>
                    <h3><i class="fas fa-info-circle"></i> 温馨提醒：</h3>
                    <ul>
                        ${data.details.map(detail => `<li>${detail}</li>`).join('')}
                    </ul>
                `;
                
                // 显示信息框
                infoBox.classList.add('active');
                
                // 初始化视频控制
                if (data.videos) {
                    const video = document.getElementById('locationVideo');
                    const qualitySelector = document.getElementById('qualitySelector');
                    const switchSourceBtn = document.getElementById('switchSourceBtn');
                    const currentSourceName = document.getElementById('currentSourceName');
                    let currentSourceIndex = 0;
                    
                    // 初始加载视频
                    loadVideoWithFallbacks(video, data.videos.sources)
                        .then(index => {
                            currentSourceIndex = index;
                            if (currentSourceName) {
                                currentSourceName.textContent = data.videos.sources[index].name;
                            }
                            if (document.getElementById('videoStatus')) {
                                document.getElementById('videoStatus').textContent = '视频可以播放了';
                            }
                        })
                        .catch(err => {
                            if (document.getElementById('videoStatus')) {
                                document.getElementById('videoStatus').innerHTML = `<strong>错误：</strong>${err}`;
                                document.getElementById('videoStatus').className = 'video-error';
                                addRetryButton(video, data.videos.sources[0].url.split('?')[0]);
                            }
                        });
                    
                    // 清晰度切换
                    if (qualitySelector && data.videos.qualities) {
                        qualitySelector.addEventListener('change', function() {
                            const selectedQuality = data.videos.qualities[this.value];
                            // 更新所有源的URL以匹配所选清晰度
                            const updatedSources = data.videos.sources.map(source => {
                                const baseUrl = source.url.replace(/(_\d+p)?\.mp4$/, '');
                                return {
                                    ...source,
                                    url: `${baseUrl}${selectedQuality.suffix}.mp4`
                                };
                            });
                            
                            if (document.getElementById('videoStatus')) {
                                document.getElementById('videoStatus').textContent = `正在切换到${selectedQuality.name}...`;
                            }
                            if (document.getElementById('videoProgress')) {
                                document.getElementById('videoProgress').style.width = '0%';
                            }
                            
                            // 重新加载视频
                            loadVideoWithFallbacks(video, updatedSources)
                                .then(index => {
                                    currentSourceIndex = index;
                                    if (currentSourceName) {
                                        currentSourceName.textContent = updatedSources[index].name;
                                    }
                                    if (document.getElementById('videoStatus')) {
                                        document.getElementById('videoStatus').textContent = `${selectedQuality.name}已准备就绪`;
                                    }
                                });
                        });
                    }
                    
                    // 切换视频源
                    if (switchSourceBtn && data.videos.sources.length > 1) {
                        switchSourceBtn.addEventListener('click', function() {
                            const nextSourceIndex = (currentSourceIndex + 1) % data.videos.sources.length;
                            
                            if (document.getElementById('videoStatus')) {
                                document.getElementById('videoStatus').textContent = `正在切换到${data.videos.sources[nextSourceIndex].name}...`;
                            }
                            if (document.getElementById('videoProgress')) {
                                document.getElementById('videoProgress').style.width = '0%';
                            }
                            
                            loadVideoWithFallbacks(video, data.videos.sources, nextSourceIndex)
                                .then(index => {
                                    currentSourceIndex = index;
                                    if (currentSourceName) {
                                        currentSourceName.textContent = data.videos.sources[index].name;
                                    }
                                    if (document.getElementById('videoStatus')) {
                                        document.getElementById('videoStatus').textContent = `已切换到${data.videos.sources[index].name}`;
                                    }
                                });
                        });
                    }
                }
            }
            
            // 高亮显示位置点
            function highlightLocation(locationId) {
                // 重置所有位置点样式
                locations.forEach(loc => {
                    loc.style.background = '#ff4757';
                    loc.style.boxShadow = '0 0 0 8px rgba(255, 71, 87, 0.4)';
                });
                
                // 高亮当前位置点
                const currentLocation = document.querySelector(`.location[data-id="${locationId}"]`);
                if (currentLocation) {
                    currentLocation.style.background = '#ffd700';
                    currentLocation.style.boxShadow = '0 0 0 12px rgba(255, 215, 0, 0.5)';
                    
                    // 3秒后恢复原样式
                    setTimeout(() => {
                        currentLocation.style.background = '#ff4757';
                        currentLocation.style.boxShadow = '0 0 0 8px rgba(255, 71, 87, 0.4)';
                    }, 3000);
                }
            }
            
            // 关闭信息按钮事件
            closeBtn.addEventListener('click', function() {
                infoBox.classList.remove('active');
                
                // 重置位置点样式
                locations.forEach(loc => {
                    loc.style.background = '#ff4757';
                    loc.style.boxShadow = '0 0 0 8px rgba(255, 71, 87, 0.4)';
                });
                
                // 移除卡片高亮
                locationCards.forEach(c => c.classList.remove('active'));
            });
            
            // 点击地图空白区域关闭信息框
            document.querySelector('.map-container').addEventListener('click', function(e) {
                if (!e.target.closest('.location') && !e.target.closest('.info-box')) {
                    infoBox.classList.remove('active');
                    locationCards.forEach(c => c.classList.remove('active'));
                }
            });
        });
    </script>
</body>
</html>
    


